{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container py-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h1 class="h4 mb-1">ğŸ Fidelidade</h1>
      <div class="text-secondary small">Acompanhe seus pontos e resgates</div>
    </div>
    <a href="/" class="btn btn-outline-light btn-sm rounded-pill">â† Home</a>
  </div>

  <!-- Card de Pontos -->
  <div class="row g-3 mb-3">
    <div class="col-12 col-lg-4">
      <div class="card bk-card p-3 h-100">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <div class="text-secondary small">Seus pontos</div>
            <div class="display-6 fw-bold mb-0">
              {{ points|default:0 }}
              <span class="fs-6 text-secondary">pts</span>
            </div>
          </div>
          <div class="badge bg-warning text-dark rounded-pill px-3 py-2">
            Brickado
          </div>
        </div>
        <div class="mt-3">
          <a href="{% url 'reward_list' %}" class="btn btn-warning w-100 rounded-pill">
            Ver recompensas
          </a>
        </div>
      </div>
    </div>

    <!-- AÃ§Ãµes rÃ¡pidas -->
    <div class="col-12 col-lg-8">
      <div class="card bk-card p-3 h-100">
        <div class="d-flex justify-content-between align-items-center mb-2">
          <div class="fw-semibold">AÃ§Ãµes rÃ¡pidas</div>
          <div class="text-secondary small">Use o que for Ãºtil pra vocÃª</div>
        </div>

        <div class="row g-2">
          <div class="col-12 col-md-6">
            <a href="{% url 'reward_list' %}" class="btn btn-outline-light w-100 rounded-pill">
              ğŸ·ï¸ Resgatar recompensas
            </a>
          </div>
          <div class="col-12 col-md-6">
            <a href="/perfil/" class="btn btn-outline-light w-100 rounded-pill">
              ğŸ‘¤ Ir para Perfil
            </a>
          </div>
          <div class="col-12 col-md-6">
            <a href="/decks/" class="btn btn-outline-light w-100 rounded-pill">
              ğŸ´ Meus Decks
            </a>
          </div>
          <div class="col-12 col-md-6">
            <a href="/torneios/" class="btn btn-outline-light w-100 rounded-pill">
              ğŸ† Ver Torneios
            </a>
          </div>
        </div>

        <div class="mt-3 text-secondary small">
          Dica: pontos podem ser usados em eventos, descontos e brindes, conforme regras da Brickado.
        </div>
      </div>
    </div>
  </div>

  <!-- Extrato / histÃ³rico -->
  <div class="card bk-card p-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
      <div class="fw-semibold">ğŸ“œ Extrato de pontos</div>
      <div class="text-secondary small">Ãšltimas movimentaÃ§Ãµes</div>
    </div>

    {% if ledger %}
      <div class="table-responsive">
        <table class="table table-dark table-hover align-middle mb-0">
          <thead>
            <tr>
              <th style="width: 160px;">Data</th>
              <th>DescriÃ§Ã£o</th>
              <th class="text-end" style="width: 120px;">Pontos</th>
            </tr>
          </thead>
          <tbody>
            {% for row in ledger %}
              <tr>
                <td class="text-secondary">{{ row.created_at|date:"d/m/Y H:i" }}</td>
                <td>
                  <div class="fw-semibold">{{ row.description|default:"MovimentaÃ§Ã£o" }}</div>
                  {% if row.meta %}
                    <div class="text-secondary small">{{ row.meta }}</div>
                  {% endif %}
                </td>
                <td class="text-end">
                  {% if row.points >= 0 %}
                    <span class="badge bg-success rounded-pill px-3">+{{ row.points }}</span>
                  {% else %}
                    <span class="badge bg-danger rounded-pill px-3">{{ row.points }}</span>
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="alert alert-dark border border-warning-subtle mb-0">
        Nenhuma movimentaÃ§Ã£o registrada ainda.
        <span class="text-secondary">Quando vocÃª ganhar ou usar pontos, vai aparecer aqui.</span>
      </div>
    {% endif %}
  </div>

</div>
{% endblock %}
